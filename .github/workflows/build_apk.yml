- name: Fix Package Structure
  run: |
    echo "=== Auto-fixing Package Structure ==="
    
    # پہلے existing package name چیک کریں
    if [ -f "android/app/src/main/AndroidManifest.xml" ]; then
      PACKAGE_NAME=$(grep 'package="' android/app/src/main/AndroidManifest.xml | head -1 | cut -d'"' -f2)
      echo "Using package from AndroidManifest: $PACKAGE_NAME"
    else
      PACKAGE_NAME="com.example.aladdin_app"  # ✅ closing quote added
      echo "Using default package: $PACKAGE_NAME"
    fi
    
    # Directory structure بنائیں
    PACKAGE_PATH=$(echo $PACKAGE_NAME | sed 's/\./\//g')
    mkdir -p android/app/src/main/kotlin/$PACKAGE_PATH/
    
    # MainActivity.kt بنائیں
    cat > android/app/src/main/kotlin/$PACKAGE_PATH/MainActivity.kt << 'EOL'
package %PACKAGE_NAME%

import io.flutter.embedding.android.FlutterActivity

class MainActivity: FlutterActivity() {
}
EOL
    # Package name replace کریں
    sed -i "s/%PACKAGE_NAME%/$PACKAGE_NAME/g" android/app/src/main/kotlin/$PACKAGE_PATH/MainActivity.kt
