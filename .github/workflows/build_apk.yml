name: Build Flutter APK

on:
  push:
    branches:
      - main
  pull_request:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # ✅ Checkout repo into valid folder name
      - name: Checkout Repository
        uses: actions/checkout@v3
        with:
          path: my_new_app

      # ✅ Setup Flutter
      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.19.5'

      # ✅ Go to project folder
      - name: Move into Project
        run: cd my_new_app

      # ✅ Disable analytics (optional, to keep logs clean)
      - name: Disable Flutter Analytics
        run: flutter config --no-analytics

      # ✅ Get dependencies
      - name: Install Dependencies
        run: |
          cd my_new_app
          flutter pub get

      # ✅ Add analysis options to ignore const warnings
      - name: Add analysis options
        run: |
          echo "include: package:flutter_lints/flutter.yaml
          linter:
            rules:
              prefer_const_constructors: false
              prefer_const_literals_to_create_immutables: false
              prefer_const_declarations: false" > my_new_app/.analysis_options.yaml

      # ✅ Analyze code
      - name: Run Analyzer
        run: |
          cd my_new_app
          flutter analyze

      # ✅ Build APK (Release)
      - name: Build Release APK
        run: |
          cd my_new_app
          flutter build apk --release
