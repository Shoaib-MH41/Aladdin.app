import 'dart:convert';
import 'package:http/http.dart' as http;

class GithubService {
  static const String _token = "YOUR_GITHUB_TOKEN"; // 🔒 اپنا پرسنل ٹوکن یہاں رکھیں
  static const String _repoOwner = "YOUR_USERNAME";
  static const String _repoName = "YOUR_PRIVATE_REPO";

  static Future<String> generateFlutterCode(String prompt) async {
    final url = Uri.parse(
      "https://api.github.com/repos/$_repoOwner/$_repoName/contents/generated_code/main.dart",
    );

    // ہم فرض کر رہے ہیں کہ GitHub پر ایک placeholder file ہے
    // اب ہم نیا کوڈ push کر رہے ہیں

    final code = """
import 'package:flutter/material.dart';

void main() => runApp(const MyApp());

class MyApp extends StatelessWidget {
  const MyApp({super.key});

  @override
  Widget build(BuildContext context) {
    return const MaterialApp(
      home: Scaffold(
        body: Center(
          child: Text('Generated by GitHub API for: $prompt'),
        ),
      ),
    );
  }
}
""";

    final base64Code = base64Encode(utf8.encode(code));

    final response = await http.put(
      url,
      headers: {
        'Authorization': 'token $_token',
        'Accept': 'application/vnd.github.v3+json',
      },
      body: jsonEncode({
        "message": "AI generated Flutter app for: $prompt",
        "content": base64Code,
      }),
    );

    if (response.statusCode == 200 || response.statusCode == 201) {
      return code;
    } else {
      throw Exception("GitHub API Error: ${response.statusCode}\n${response.body}");
    }
  }
}

