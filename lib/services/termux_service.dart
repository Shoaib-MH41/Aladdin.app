import 'dart:io';

class TermuxService {
  static Future<String> buildAPK(String projectName, String flutterCode) async {
    try {
      print("ðŸš€ APK Ø¨Ù†Ø§Ù†Û’ Ú©Ø§ Ù¾Ø±ÙˆØ³ÛŒØ³ Ø´Ø±ÙˆØ¹...");

      // âœ… Ù¾ÛÙ„Û’ Download folder Ù…ÛŒÚº ÚˆØ§Ø¦Ø±ÛŒÚ©Ù¹Ø±ÛŒ Ø¨Ù†Ø§Ø¦ÛŒÚº
      final downloadDir = Directory('/storage/emulated/0/Download/aladdin_projects');
      if (!await downloadDir.exists()) {
        await downloadDir.create(recursive: true);
      }

      final projectDir = Directory('${downloadDir.path}/$projectName');
      if (await projectDir.exists()) {
        await projectDir.delete(recursive: true);
      }
      await projectDir.create(recursive: true);

      // âœ… lib ÚˆØ§Ø¦Ø±ÛŒÚ©Ù¹Ø±ÛŒ Ø¨Ù†Ø§Ø¦ÛŒÚº
      final libDir = Directory('${projectDir.path}/lib');
      await libDir.create(recursive: true);

      // âœ… main.dart ÙØ§Ø¦Ù„ Ø¨Ù†Ø§Ø¦ÛŒÚº
      final mainFile = File('${libDir.path}/main.dart');
      await mainFile.writeAsString(flutterCode);

      // âœ… pubspec.yaml Ø¨Ù†Ø§Ø¦ÛŒÚº
      final pubspecFile = File('${projectDir.path}/pubspec.yaml');
      await pubspecFile.writeAsString('''
name: $projectName
description: Generated by Aladdin App Factory
publish_to: 'none'
version: 1.0.0+1

environment:
  sdk: '>=3.0.0 <4.0.0'

dependencies:
  flutter:
    sdk: flutter
  cupertino_icons: ^1.0.2

flutter:
  uses-material-design: true
''');

      // âœ… Termux Ù…ÛŒÚº Ø¯Ø³ØªÛŒ ÛØ¯Ø§ÛŒØ§Øª ÙˆØ§Ù¾Ø³ Ú©Ø±ÛŒÚº
      return """
âœ… **Flutter Ù¾Ø±ÙˆØ¬ÛŒÚ©Ù¹ ØªÛŒØ§Ø± ÛÙˆ Ú¯ÛŒØ§!**

ðŸ“ **Ù¾Ø±ÙˆØ¬ÛŒÚ©Ù¹ Ù„ÙˆÚ©ÛŒØ´Ù†:**
/storage/emulated/0/Download/aladdin_projects/$projectName

ðŸ“± **APK Ø¨Ù†Ø§Ù†Û’ Ú©Û’ Ù„ÛŒÛ’ Termux Ù…ÛŒÚº ÛŒÛ commands Ú†Ù„Ø§Ø¦ÛŒÚº:**

```bash
cd /storage/emulated/0/Download/aladdin_projects/$projectName
flutter clean
flutter pub get
flutter build apk --release --no-tree-shake-icons
